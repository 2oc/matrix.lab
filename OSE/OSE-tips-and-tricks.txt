# MISC
#oc create -f /usr/share/openshift/examples/image-streams/image-streams-rhel7.json -n openshift
#oc create -f /usr/share/openshift/examples/db-templates -n openshift
#oc create -f /usr/share/openshift/examples/quickstart-templates -n openshift

# Setting a default route (probably not necessary)
sed -i "s/router.default.local/cloudapps-${GUID}.oslab.opentlc.com/g" /etc/openshift/master/master-config.yaml
systemctl restart openshift-master

# Review logs
journalctl -f -u openshift-master
journalctl -f -u openshift-node

# REMOVE ALL REGISTRY ENTRIES
  for resource in service deploymentConfig pod route serviceaccount secret rc; do
    resource_names=$(oc get $resource | awk '/registry/ {print $1}')
    for name in ${resource_names/'\n'/ }; do
      echo "oc delete $resource $name"
      oc delete $resource $name
    done
  done


# Setting a default node (no idea why though?)
sed -i 's/defaultNodeSelector: ""/defaultNodeSelector: "region=primary"' /etc/openshift/master/master-config.yaml
systemctl restart openshift-master

# ugg...
# ERROR: fd02f32d9022: Error pulling image (latest) from docker.io/openshift/hello-openshift, Driver devicemapper failed to create image rootfs 3d8b115ccd046adf638166a337b6ebe8ad2a
# DO NOT STOP DOCKER
rm -rf /var/lib/docker/*
REGISTRY="registry.access.redhat.com"; PTH="openshift3"
REGISTRY="rh7sat6.matrix.lab"; PTH="openshift3"
IMAGES="ose-haproxy-router:v3.0.0.1
ose-deployer:v3.0.0.1
ose-sti-builder:v3.0.0.1
ose-sti-image-builder:v3.0.0.1
ose-docker-builder:v3.0.0.1
ose-pod:v3.0.0.1
ose-keepalived-ipfailover:v3.0.0.1
ruby-20-rhel7
mysql-55-rhel7
hello-openshift:v0.4.3
ose-docker-registry:v3.0.2.0"
for IMG in $IMAGES; do echo "\"docker pull "$REGISTRY/$PTH/${IMG}\""; docker pull "$REGISTRY/$PTH/${IMG}"; done

# CLEANUP (REMOVE) PROJECT OBJECTS
oc project <project name>
oc delete all --all

# Check ETCD health
etcdctl -C \
   https://rh7osetcd01.aperture.lab:2379,https://rh7osetcd02.aperture.lab:2379,https://rh7osetcd03.aperture.lab:2379 \
   --ca-file=/etc/etcd/generated_certs/openshift-master-rh7osemst01.aperture.lab/master.etcd-ca.crt \
   --cert-file=/etc/etcd/generated_certs/openshift-master-rh7osemst01.aperture.lab/master.etcd-client.crt \
   --key-file=/etc/etcd/generated_certs/openshift-master-rh7osemst01.aperture.lab//master.etcd-client.key cluster-health

# If you manage to log yourself out of the default project
oc login -u system:admin -n default
